openapi: 3.0.0
info:
  title: API do Meu Comercio
  version: 1.0.0
  description: Documentação da API do Meu Comercio
security: []
paths:
  /api/admin:
    get:
      summary: Verifica se já existe um administrador
      tags:
        - Admin
      description: Retorna se existe algum usuário com a role "Administrador".
      responses:
        '200':
          description: Resultado da verificação
          content:
            application/json:
              schema:
                type: object
                properties:
                  hasAdmin:
                    type: boolean
                    example: true
        '500':
          description: Erro interno ao listar usuários
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Failed to list users
    post:
      summary: Cria o primeiro administrador
      tags:
        - Admin
      description: Cria um usuário com role "Administrador" apenas se não existir outro.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  example: admin@empresa.com
                password:
                  type: string
                  example: SenhaSegura123
                displayName:
                  type: string
                  example: Administrador
      responses:
        '200':
          description: Administrador criado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  uid:
                    type: string
                    example: abc123xyz
                  email:
                    type: string
                    example: admin@empresa.com
                  message:
                    type: string
                    example: Administrador criado com sucesso!
        '400':
          description: Erro de validação (email/senha ausente ou admin já existente)
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Administrador já existe
        '500':
          description: Erro interno ao criar o usuário
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Erro ao criar usuário no Firebase

  /api/profile:
    get:
      summary: Retorna dados do usuário autenticado
      tags:
        - Perfil
      description: Retorna as informações básicas do usuário logado (uid, displayName, email, photoURL).
      responses:
        '200':
          description: Dados do usuário
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Profile'
        '401':
          description: Não autenticado
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
                    example: Não autenticado
    put:
      summary: Atualiza nome e foto do perfil
      tags:
        - Perfil
      description: Atualiza o displayName e/ou photoURL do usuário autenticado.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                displayName:
                  type: string
                  example: "Pedro Souza"
                photoURL:
                  type: string
                  example: "https://exemplo.com/foto.png"
      responses:
        '200':
          description: Perfil atualizado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Perfil atualizado
        '400':
          description: Requisição inválida
        '401':
          description: Não autenticado

  /api/profile/email:
    post:
      summary: Solicitar troca de e-mail (envia verificação)
      tags:
        - Perfil
      description: Reautentica com a senha atual e envia o e-mail de verificação para alteração do e-mail.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentPassword
                - newEmail
              properties:
                currentPassword:
                  type: string
                  example: "SenhaAtual123"
                newEmail:
                  type: string
                  example: "novo@email.com"
      responses:
        '200':
          description: Solicitação enviada (verifique o novo e-mail)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Verifique seu novo e-mail para confirmação
        '400':
          description: Dados inválidos
        '401':
          description: Reautenticação falhou

  /api/profile/password:
    post:
      summary: Trocar senha do usuário
      tags:
        - Perfil
      description: Reautentica com a senha atual e atualiza a senha do usuário. (Após sucesso, faz logout)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentPassword
                - newPassword
              properties:
                currentPassword:
                  type: string
                  example: "SenhaAtual123"
                newPassword:
                  type: string
                  example: "NovaSenha123"
      responses:
        '200':
          description: Senha atualizada (usuário deslogado)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: Senha atualizada, faça login novamente
        '400':
          description: Dados inválidos
        '401':
          description: Reautenticação falhou

  /api/feedback:
    post:
      summary: Enviar feedback / report de suporte
      tags:
        - Suporte
      description: Recebe email, assunto (opcional) e descrição do feedback e salva no Firestore.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FeedbackInput'
      responses:
        '201':
          description: Feedback criado com sucesso
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                  email:
                    type: string
                  descricao:
                    type: string
        '400':
          description: Campos obrigatórios ausentes ou inválidos
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string
        '500':
          description: Erro interno do servidor
          content:
            application/json:
              schema:
                type: object
                properties:
                  error:
                    type: string

components:
  schemas:
    Profile:
      type: object
      properties:
        uid:
          type: string
          example: "abc123uid"
        displayName:
          type: string
          example: "Pedro Souza"
        email:
          type: string
          example: "usuario@exemplo.com"
        photoURL:
          type: string
          example: "https://exemplo.com/foto.png"

    FeedbackInput:
      type: object
      required:
        - email
        - descricao
      properties:
        email:
          type: string
          format: email
          example: usuario@exemplo.com
        assunto:
          type: string
          example: "Problema no checkout"
        descricao:
          type: string
          example: "Ao finalizar a venda o sistema retorna erro 500..."

tags:
  - name: Admin
    description: Gerenciamento do usuário administrador
  - name: Perfil
    description: Operações relacionadas ao perfil do usuário (visualizar/atualizar nome, foto, e-mail e senha)
  - name: Suporte
    description: Envio de feedbacks e solicitações de suporte
